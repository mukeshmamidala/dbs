/**Devcartel Version 1.2.3**/
(function($){$.devcartel=$.devcartel||{};$.extend($.devcartel,{version:"1.2.3",escapeString:function(string){var escaped=string;if(escaped.indexOf('.')!=-1){escaped=escaped.replace(/\./g,'');}
if(escaped.indexOf('=')!=-1){escaped=escaped.replace(/\=/g,'');}
if(escaped.indexOf('/')!=-1){escaped=escaped.replace(/\//g,'');}
return escaped;},formatNumber:function(number,isSign,isThousand){var num=parseFloat($.trim(number.toString()));var numStr=number.toString();if(isThousand){var parts=numStr.split('.');numStr=parts[0].replace(/\B(?=(\d{3})+(?=$))/g,",")+(parts.length>1?"."+parts[1]:"");}
if(isSign&&num>0){numStr="+"+numStr;}
return numStr;}});})(jQuery);(function($){$.widget("devcartel.devcartel_marketoverview_quote",{options:{url:"",service:"",container:"#DevCartel_MarketOverview_Quote",symbols:null,symbolNames:null,fields:null,fieldLabels:null,showName:true,showTick:true,showMiniChart:false,miniChartConfig:{url:"",service:"",chartOptions:{},dataInterval:null,width:300,height:170}},_mandatoryFields:["PRCTCK_1","DSPLY_NAME"],_subscribedFields:null,_controller:null,_collection:null,_trHeadString:"",_trString:"",_emptyString:"",_lastStatusCode:1,_miniChartHolder:null,_minChart:null,_create:function(){try{this._validateOptions();this._populateTemplate();this._populateDisplay();this._populateSourceLastUpdate();this._controller=new TrisUI.controller.IDSQuote({url:this.options.url,fields:this._subscribedFields,service:this.options.service,maxSubscription:0,batchSubscribe:true,enableEnumConversion:true,expandChain:false,dynamicChain:false});this._collection=this._controller.get('itemCollection');this._collection.bind('add',this._handleAddCollection,this);this._controller.get('status').bind('change',this._onStatusUpdate,this);this._controller.addSubject({subjects:this.options.symbols});}catch(e){this.element.append('<span style="color: red"> Error: '+e.message+'</span>');}},_setOption:function(key,value){this._super(key,value);},_setOptions:function(options){this._super(options);this._validateOptions();this._populateTemplate();},_validateOptions:function(){var options=this.options;if(!options.url){throw new Error("URL not found");}
if(!options.container){throw new Error("Container not found");}
if(!options.symbols){throw new Error("Symbol not found");}
if(!options.symbolNames){throw new Error("Symbol Name not found");}
if(!options.fields){throw new Error("Field not found");}
if(!options.fieldLabels){throw new Error("Field Label not found");}
if(options.showMiniChart){var chartConfig=options.miniChartConfig;if(!chartConfig.url){throw new Error("MiniChart: URL not found");}
if(!chartConfig.service){throw new Error("MiniChart: URL not found");}
if(!chartConfig.url){throw new Error("MiniChart: URL not found");}
if(!chartConfig.dataInterval){throw"MiniChart: Data Interval not found";}
if(!chartConfig.width){throw"MiniChart: Width not found";}
if(!chartConfig.height){throw"MiniChart: Height not found";}}
this._subscribedFields=[];$.merge(this._subscribedFields,this._mandatoryFields);for(var i=0;i<options.fields.length;i++){var fields=options.fields[i];if(!$.isArray(fields)){fields=[fields];}
$.merge(this._subscribedFields,fields);}},_handleAddCollection:function(model){model.bind('change:fields',this._onModelDataUpdate,this);},_onModelDataUpdate:function(model,value,options){var symbol=model.get('subject');var changed=model.get('fields').changedAttributes();var table=this._getQuoteTable();var containerId=this._getContainerId();var escapedSymbol=$.devcartel.escapeString(symbol);var self=this;$.each(changed,function(field,changedValue){if($.inArray(field,self._subscribedFields)==-1){return;}
if(changedValue==null||changedValue==undefined){changedValue=self._emptyString;}
var elementId=self._getFieldId(containerId,escapedSymbol,field);var element=table.find("#"+elementId);if(field=='PRCTCK_1'){return;}else if(field=="NETCHNG_1"||field=="BID_NET_CH"){changedValue=self._formatChngValue(changedValue);}else if(field=="PCTCHNG"){changedValue=self._formatPctChngValue(changedValue);}else if(field=='DSPLY_NAME'){var k=-1;if(!self.options.showName||(k=$.inArray(symbol,self.options.symbols))==-1){return;}
var defaultDisplayName=self.options.symbolNames[k];changedValue=(defaultDisplayName!=''?defaultDisplayName:changedValue);}else if($.isNumeric(changedValue)){changedValue=self._formatNumberValue(changedValue);}
element.html(changedValue.toString());var children=element.parent().children();children.hide();for(var i=0;i<children.length;i++){var child=$(children[i]);var value=$.trim(child.html());if(value!=""){child.show();break;}else if(i==children.length-1){child.show();child.html("NA");}}});},_onStatusUpdate:function(model,value,options){if(!this.options.showName){return;}
var statusCode=this._controller.get('status').get('statusCode');var statusText=this._controller.get('status').get('statusText');if(this._lastStatusCode==statusCode){return;}
this._lastStatusCode=statusCode;var table=this._getQuoteTable();var containerId=this._getContainerId();for(var i=0;i<this.options.symbols.length;i++){var escapedSymbol=$.devcartel.escapeString(this.options.symbols[i]);var elementId=this._getFieldId(containerId,escapedSymbol,'DSPLY_NAME');var element=table.find("#"+elementId);if(statusCode==1){var defaultDisplayName=this.options.symbolNames[i];element.html((defaultDisplayName!=''?defaultDisplayName:this._emptyString));}else{element.html('<span class="status">'+statusText+'</span>');}}},_formatChngValue:function(value){if(value===""){return value;}
var str=$.devcartel.formatNumber(value,true,false);if(str.substring(0,1)=='-'){str='<span class="down">'+str+"</span>";}else{str='<span class="up">'+str+"</span>";}
return str;},_formatPctChngValue:function(value){if(value===""){return value;}
value=value.toFixed(2);
var str=$.devcartel.formatNumber(value,true,false);if(str.substring(0,1)=='-'){str='<span class="down">'+str+"%</span>";}else{str='<span class="up">'+str+"%</span>";}
return str;},_formatNumberValue:function(value){var str=$.devcartel.formatNumber(value,false,true);return str;},_populateTemplate:function(){var self=this;var trHeadString="<tr>";var trString='<tr id="%%WIDGETID%%_%%SYMBOL%%_TR">';if(self.options.showTick){trHeadString+="<td class='tableHead'>&nbsp;</td>";trString+='<td><span id="%%WIDGETID%%_%%SYMBOL%%_PRCTCK_1"> </span></td>';}
if(self.options.showName){trHeadString+="<td class='tableHead'>&nbsp;</td>";trString+='<td class="symbolDisplayName"><span id="%%WIDGETID%%_%%SYMBOL%%_DSPLY_NAME">%%DEFAULT_DISPLAY_NAME%%</span></td>';}
$.each(self.options.fieldLabels,function(index,label){trHeadString += "<td class='tableHead tableCol" + index + "'>" + label + "</td>";});$.each(self.options.fields,function(index,fields){trString += "<td class='tableCol" + index + "'>";if(!$.isArray(fields)){fields=[fields];}
for(var i=0;i<fields.length;i++){var display=(i==0?'':'style="display: none;"');trString+='<span id="%%WIDGETID%%_%%SYMBOL%%_'+fields[i]+'" '+display+'>'+self._emptyString+'</span>';}
trString+='</td>';});trHeadString+="</tr>";trString+="</tr>";this._trHeadString=trHeadString;this._trString=trString;},_populateDisplay:function(){var table=$('<table id="'+this._getContainerId()+'_Table" style="width: 100%; height: 100%;"><tbody></tbody></table>');table.appendTo(this.element);$(this._trHeadString).appendTo(table.find("tbody:last"));for(var i=0;i<this.options.symbols.length;i++){var symbol=this.options.symbols[i];var defaultDisplayName=this.options.symbolNames[i];this._populateSymbolRow(table,symbol,defaultDisplayName);}
if(this.options.showMiniChart&&this.options.showName){var chartConfig=this.options.miniChartConfig;var miniChartId=this._getContainerId()+'_MiniChart';var miniChartHolder=$('<div class="mini-chart-holder"><div style="display: inline-block;" class="mini-chart-head">&nbsp;</div> (UTC)</div>');miniChartHolder.appendTo(this.element);miniChartHolder.css({"position":"absolute"});var miniChart=$('<div id="'+miniChartId+'" class="mini-chart-body"></div>');miniChart.appendTo(miniChartHolder);miniChart.devcartel_marketoverview_chart({url:chartConfig.url,service:chartConfig.service,container:"#"+miniChartId,symbols:[],dataInterval:chartConfig.dataInterval,chartOptions:chartConfig.chartOptions,"width":chartConfig.width,"height":chartConfig.height});this._miniChartHolder=miniChartHolder;this._miniChart=miniChart;miniChartHolder.hide();var containerId=this._getContainerId();for(var i=0;i<this.options.symbols.length;i++){var escapedSymbol=$.devcartel.escapeString(this.options.symbols[i]);var elementId=this._getFieldId(containerId,escapedSymbol,"DSPLY_NAME");var element=table.find("#"+elementId);var self=this;var symbol=this.options.symbols[i];var symbolName=this.options.symbolNames[i];element.bind("mouseover",{symbol:symbol,symbolName:symbolName},function(e){var currentSymbol=e.data.symbol;var currentName=e.data.symbolName;if(!currentName||currentName==''){currentName=$(e.currentTarget).html();}
var dataInterval=self.options.miniChartConfig.dataInterval;dataInterval["endDate"]=new Date();self._miniChart.devcartel_marketoverview_chart("changeDataInterval",dataInterval);self._miniChart.devcartel_marketoverview_chart("changeSymbol",currentSymbol);var pos=$(e.currentTarget).offset();var width=$(e.currentTarget).width();var height=$(e.currentTarget).height();self._miniChartHolder.css({left:(pos.left+width)+"px",top:(pos.top+height)+"px"});self._miniChartHolder.children().first().html(currentName);self._miniChartHolder.find('#sourceinfo').remove();self._miniChartHolder.show("slow");});element.mouseout(function(){self._miniChartHolder.hide();});element.css({"cursor":"pointer"});}}},_populateSourceLastUpdate:function(){var now=new Date();var now_utc=now.toUTCString().replace('GMT','UTC');sourceLastUpdate='<span id="sourceinfo" style="float:right; color:#ccc; margin-top:0; font-weight: bold; font-size: 73%">'+'Last Updated: '+now_utc+'</span>'
this.element.append($(sourceLastUpdate));},_populateSymbolRow:function(table,symbol,defaultDisplayName){var newRowString=this._trString;var escapedSymbol=$.devcartel.escapeString(symbol);newRowString=newRowString.replace(/%%WIDGETID%%/g,this._getContainerId());newRowString=newRowString.replace(/%%SYMBOL%%/g,escapedSymbol);newRowString=newRowString.replace(/%%DEFAULT_DISPLAY_NAME%%/g,(defaultDisplayName!=''?defaultDisplayName:this._emptyString));table.find("tbody:last").append(newRowString);},_getQuoteTable:function(){var table=$("#"+this._getContainerId()+"_Table");return table;},_getContainerId:function(){var id=this.options.container;if(id.search("#")!=-1){id=id.substring(1,id.length);}
return id;},_getFieldId:function(prefix,symbol,field){return(prefix+'_'+symbol+'_'+field);},_destroy:function(){if(this._miniChart){this._miniChart.remove();this._miniChart=undefined;}
if(this._miniChartHolder){this._miniChartHolder.remove();this._miniChartHolder=undefined;}
if(this._controller){this._controller.removeSubject({subjects:this.options.symbols});this._controller.cleanUp();this._controller=undefined;}
if(this._collection){this._collection=undefined;}
var table=this._getQuoteTable();if(table[0]){table.remove();}
this._fieldsMap=undefined;}});})(jQuery);(function($){$.widget("devcartel.devcartel_marketoverview_chart",{options:{service:'',container:"#DevCartel_MarketOverview_Chart",symbols:null,url:'',dataInterval:{interval:'DAILY',frequency:'1',displayUnit:'D',startDate:new Date((new Date()).getTime()-(1*(1000*60*60*24))),endDate:new Date()},chartOptions:{},width:627,height:240},_controller:null,_view:null,_create:function(){try{var self=this;this._validateOptions();this._controller=new TrisUI.controller.FinanceChart({'url':this.options.url,'service':this.options.service,'dataInterval':this.options.dataInterval,'enableVolumeChart':false,'enableRangeChart':false});this._view=new TrisUI.view.ChartView({container:this.options.container,controller:this._controller,model:this._controller.get('graphCollection').get('main'),chartOptions:this.options.chartOptions,fieldIdx:4,lineType:'LINE',enableDataTooltip:true,enableSplitAnnotation:false,enableInfoBar:false,size:{width:this.options.width,height:this.options.height},trackFormatter:function(options){return self._trackFormatter(options);}});if(this.options.symbols.length>0){var result=this._controller.addSubject({'subject':this.options.symbols[0],'isMain':true});if(!result){throw new Error("Failed to subscribe chart");}}
this._populateSourceLastUpdate();}catch(e){this.element.append($('<span style="color: red">'+e.message+"</span>"));}},changeDataInterval:function(option){this.option("dataInterval",option);},changeSymbol:function(symbol){var oldSymbols=this.options.symbols;this.options.symbols=[symbol];var result=this._controller.addSubject({subject:this.options.symbols[0],isMain:true});if(oldSymbols.length>0){this._controller.removeSubject({subject:oldSymbols[0]});}
return result;},_setOption:function(key,value){this._super(key,value);},_setOptions:function(options){this._super(options);this._refresh();},_refresh:function(){if(this.options.dataInterval){this._controller.changeDataInterval(this.options.dataInterval);}},_validateOptions:function(){var options=this.options;if(!options.symbols){throw"Symbol not found";}
if(!options.url){throw"URL not found";}
if(!options.dataInterval){throw"Data Interval not found";}
if(!options.width){throw"Width not found";}
if(!options.height){throw"Height not found";}},_trackFormatter:function(options){return options.y+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";},_destroy:function(){if(this._controller){for(var i=0;i<this.options.symbols.length;i++){this._controller.removeSubject({subject:this.options.symbols[i]});}
this._controller.cleanUp();this._controller=undefined;}
if(this._view){this._view.remove();this._view=null;}},_populateSourceLastUpdate:function(){var now=new Date();var now_utc=now.toUTCString().replace('GMT','UTC');sourceLastUpdate='<span id="sourceinfo" style="float:right; color:#ccc; margin-top:0; font-weight: bold; font-size: 73%">'+'Last Updated: '+now_utc+'</span>'
this.element.append($(sourceLastUpdate));}});})(jQuery);